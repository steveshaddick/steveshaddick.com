var MailList = function() {
    var a;
    var b;
    var c = false;
    var d = false;
    var e = null;
    function f() {
        a = $("#mailList");
        a.on("mouseenter", j).on("mouseleave", k);
        b = $("#txtEmail");
    }
    function g(a) {
        if (e) {
            clearTimeout(e);
            e = setTimeout(l, 5e3);
        }
        switch (a.which) {
          case 32:
          case 39:
          case 34:
          case 96:
            a.preventDefault();
            return false;
            break;

          case 13:
            h();
            return false;
            break;
        }
        if (c) {
            c = false;
            $("#emailError").addClass("displayNone");
        }
    }
    function h() {
        var a = b.val();
        if (a == "" || !n(a)) {
            m();
            return;
        }
        l();
        b.val("");
        $.ajax("/ajax/submitEmail", {
            cache: false,
            data: {
                txtEmail: a,
                a: GLOBAL.a
            },
            success: i,
            type: "post",
            error: function() {
                i({
                    success: "false"
                });
            }
        });
    }
    function i(a) {
        if (a && a.success === true) {
            Main.showAlert("/views/emailSuccess.html");
        } else {
            Main.showAlert("/views/emailError.html");
        }
    }
    function j() {
        if (e) {
            clearTimeout(e);
        }
        if (d) return;
        d = true;
        a.addClass("open");
        b.bind("keydown", g);
    }
    function k() {
        e = setTimeout(l, 2e3);
    }
    function l() {
        d = false;
        a.removeClass("open");
        b.unbind("keydown", g).blur();
    }
    function m() {
        c = true;
        $("#emailError").removeClass("displayNone");
    }
    function n(a) {
        var b = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return b.test(a);
    }
    return {
        init: f,
        submitEmail: h
    };
}();

function csrfSafeMethod(a) {
    return /^(GET|HEAD|OPTIONS|TRACE)$/.test(a);
}

var Work = function() {
    var a = false;
    var b = false;
    var c = false;
    var d = false;
    var e = false;
    var f = false;
    function g() {
        a = $("#workWrapper");
        c = $("#noWork");
        b = $("#thumbsWrapper");
        e = $("#videoPlayerContainer");
        Video.init({
            videoPath: "http://video.steveshaddick.com"
        });
        d = c.parent();
    }
    function h() {
        var a = $(this);
        var c = $('<img class="thumb-over-img transition" src="' + $("img", a).attr("src") + '" alt="">');
        var d = a.position();
        c.css({
            top: d.top + 5,
            left: d.left + 5,
            width: 50,
            height: 50
        });
        var e = $("#cls .thumb-over-info").clone();
        $(".title", e).html(a.attr("data-title"));
        $(".type", e).html(a.attr("data-type"));
        e.css({
            top: -500,
            left: d.left - 5
        });
        c.data("info", e);
        b.append(c);
        setTimeout(function() {
            c.css({
                top: d.top - 5,
                left: d.left - 5,
                width: 70,
                height: 70
            });
        }, 5);
        b.append(e);
        setTimeout(function() {
            e.css({
                top: d.top + 65
            });
        }, 250);
    }
    function i() {
        var a = $(this).position();
        var b = $(this);
        b.css({
            top: a.top + 10,
            left: a.left + 10,
            width: 50,
            height: 50
        }).data("info").css({
            top: "100%"
        });
        TransitionController.transitionEnd(b, function() {
            b.data("info").remove();
            b.remove();
        });
    }
    function j() {}
    function k() {
        $(".me-blurry", c).removeClass("out");
    }
    function l(b) {
        $.post("/work/" + b + "/", {}, function(b) {
            if (b && b.success) {
                if (f) {
                    $("#work_" + f.id).removeClass("selected");
                    switch (f.type) {
                      case "video":
                        Video.clearVideo();
                        var c = $("#cls .video-swap").clone();
                        c.css({
                            height: e.height(),
                            width: e.width()
                        });
                        $("cls").append(e);
                        $(".video-container", d).append(c);
                        break;
                    }
                }
                var g = d;
                g.addClass("drop");
                TransitionController.transitionEnd(g, function() {
                    g.remove();
                });
                f = b;
                d = $("#cls .work-content").clone();
                $("h1", d).html(b.title);
                if (b.specs != "") {
                    $(".work-specs", d).html(b.specs);
                }
                if (b.info != "") {
                    $(".work-info", d).html(b.info);
                } else {
                    $(".work-info", d).remove();
                }
                $("#work_" + b.id).addClass("selected");
                var h = false;
                switch (b.type) {
                  case "video":
                    $(".video-container", d).append(e);
                    h = function() {};
                    break;

                  case "website":
                    break;
                }
                a.append(d);
                setTimeout(function() {
                    d.removeClass("hold-high");
                    if (h) {
                        TransitionController.transitionEnd(d, h);
                    }
                }, 10);
            } else {
                j();
            }
        });
    }
    return {
        init: g,
        getWork: l,
        showNoWork: k
    };
}();

var Main = function() {
    function a(a) {
        $.ajaxSetup({
            crossDomain: false,
            beforeSend: function(a, b) {
                if (!csrfSafeMethod(b.type)) {
                    a.setRequestHeader("X-CSRFToken", Cookie.get("csrftoken"));
                }
            }
        });
        if (!Modernizr.csstransitions) {
            TransitionController.setAutoWait(350);
        }
        Work.init();
        SWFAddress.onChange = b;
        if (a.needUrlCheck) {
            $.get("/check-urls/");
        }
    }
    function b() {
        var a = SWFAddress.getPathNames();
        if (a.length > 0) {
            switch (a[0]) {
              case "who":
                $("body").addClass("page-who");
                break;

              default:
                $("body").removeClass("page-who");
                Work.getWork(a[0]);
                break;
            }
        } else {
            $("body").removeClass("page-who");
            Work.showNoWork();
        }
    }
    return {
        init: a
    };
}();

var TransitionController = function() {
    var a = {
        WebkitTransition: "webkitTransitionEnd",
        MozTransition: "transitionend",
        transition: "transitionend"
    }, b = a[Modernizr.prefixed("transition")], c = -1;
    function d(a, d, e) {
        if (typeof e === "undefined") {
            e = c;
        }
        if (e < 0) {
            a.unbind(b);
            a.bind(b, function() {
                a.unbind(b);
                d(a);
            });
        } else {
            setTimeout(function() {
                d(a);
            }, e);
        }
    }
    function e(a) {
        c = a;
    }
    return {
        transitionEnd: d,
        setAutoWait: e
    };
}();

var Video = function() {
    var a;
    var b;
    var c;
    var d;
    var e = false;
    var f;
    var g;
    var h = "/";
    function i(a) {
        if (typeof a.nativeControls === "undefined") a.nativeControls = false;
        if (typeof a.trueFullscreen === "undefined") a.trueFullscreen = true;
        if (typeof a.fullscreenHandler === "undefined") a.fullscreenHandler = function() {};
        if (typeof a.normalscreenHandler === "undefined") a.normalscreenHandler = function() {};
        if (typeof a.videoPath === "undefined") a.videoPath = "";
        d = new SimpleVideo("simpleVideo", {
            nativeControls: a.nativeControls,
            allowFullscreen: !$("html").is(".ie7, .ie8"),
            trueFullscreen: a.trueFullscreen,
            onFullscreen: a.fullscreenHandler,
            onNormalscreen: a.normalscreenHandler
        });
        h = a.videoPath + "/";
    }
    function j(a) {
        if (!e) {
            d.init(function() {
                e = true;
            });
            clearTimeout(f);
            setTimeout(function() {
                j(a);
            }, 100);
            return;
        }
        d.setFile([ {
            src: h + a.videoFile,
            type: "video/mp4"
        } ], a.type === "audio");
        if (typeof a.allowScrub === "undefined") a.allowScrub = true;
        d.setScrub(a.allowScrub);
        if (typeof a.hasAudio === "undefined") a.hasAudio = true;
        d.setHasAudio(a.hasAudio);
        d.setRepeat(a.loop);
        d.play();
    }
    function k() {
        if (!e) return;
        d.pause();
    }
    function l() {
        if (!e) return;
        d.play();
    }
    function m() {
        if (!e) return;
        d.seek(0);
    }
    function n() {
        if (!e) return;
        d.clear();
    }
    return {
        init: i,
        playVideo: j,
        clearVideo: n,
        pauseVideo: k,
        resumeVideo: l
    };
}();