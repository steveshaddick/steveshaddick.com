var MailList = function() {
    var a;
    var b;
    var c = false;
    var d = false;
    var e = null;
    function f() {
        a = $("#mailList");
        a.on("mouseenter", j).on("mouseleave", k);
        b = $("#txtEmail");
    }
    function g(a) {
        if (e) {
            clearTimeout(e);
            e = setTimeout(l, 5e3);
        }
        switch (a.which) {
          case 32:
          case 39:
          case 34:
          case 96:
            a.preventDefault();
            return false;
            break;

          case 13:
            h();
            return false;
            break;
        }
        if (c) {
            c = false;
            $("#emailError").addClass("displayNone");
        }
    }
    function h() {
        var a = b.val();
        if (a == "" || !n(a)) {
            m();
            return;
        }
        l();
        b.val("");
        $.ajax("/ajax/submitEmail", {
            cache: false,
            data: {
                txtEmail: a,
                a: GLOBAL.a
            },
            success: i,
            type: "post",
            error: function() {
                i({
                    success: "false"
                });
            }
        });
    }
    function i(a) {
        if (a && a.success === true) {
            Main.showAlert("/views/emailSuccess.html");
        } else {
            Main.showAlert("/views/emailError.html");
        }
    }
    function j() {
        if (e) {
            clearTimeout(e);
        }
        if (d) return;
        d = true;
        a.addClass("open");
        b.bind("keydown", g);
    }
    function k() {
        e = setTimeout(l, 2e3);
    }
    function l() {
        d = false;
        a.removeClass("open");
        b.unbind("keydown", g).blur();
    }
    function m() {
        c = true;
        $("#emailError").removeClass("displayNone");
    }
    function n(a) {
        var b = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return b.test(a);
    }
    return {
        init: f,
        submitEmail: h
    };
}();

function csrfSafeMethod(a) {
    return /^(GET|HEAD|OPTIONS|TRACE)$/.test(a);
}

var Work = function() {
    var a = false;
    var b = false;
    var c = false;
    var d = false;
    var e = false;
    var f = false;
    function g() {
        a = $("#workWrapper");
        c = $("#noWork");
        b = $("#thumbsWrapper");
        e = $("#videoPlayerContainer");
        Video.init({
            videoPath: "http://video.steveshaddick.com"
        });
        d = c.parent();
        b.on("mouseenter", ".work-thumb", h);
        b.on("mouseleave", ".thumb-over-img", i);
    }
    function h() {
        var a = $(this);
        if (a.data("isOver") === true) return;
        a.data("isOver", true);
        var b = $('<img class="thumb-over-img transition small" src="' + $("img", a).attr("src") + '" alt="">');
        var c = $("#cls .thumb-over-info").clone();
        $(".title", c).html(a.attr("data-title"));
        $(".type", c).html(a.attr("data-type"));
        b.data("info", c);
        a.append(b);
        b.data("to1", setTimeout(function() {
            b.removeClass("small");
        }, 5));
        a.append(c);
        b.data("to2", setTimeout(function() {
            c.removeClass("hold-high");
        }, 250));
    }
    function i() {
        var a = $(this);
        var b = a.data("info").offset();
        var c = a.data("info");
        a.data("info").css({
            top: b.top - $(window).scrollTop(),
            left: b.left
        });
        $("#dropOverlay").append(c);
        a.addClass("small");
        setTimeout(function() {
            c.css("top", "").addClass("drop");
        }, 10);
        clearTimeout(a.data("to1"));
        clearTimeout(a.data("to2"));
        setTimeout(function() {
            a.parent().data("isOver", false);
            a.remove();
        }, 350);
        setTimeout(function() {
            c.remove();
        }, 500);
    }
    function j() {}
    function k() {
        $(".me-blurry", c).removeClass("out");
    }
    function l(b) {
        $.post("/work/" + b + "/", {}, function(b) {
            if (b && b.success) {
                if (f) {
                    $("#work_" + f.id).removeClass("selected");
                    switch (f.type) {
                      case "video":
                        Video.clearVideo();
                        var c = $("#cls .video-swap").clone();
                        c.css({
                            height: e.height(),
                            width: e.width()
                        });
                        $("#cls").append(e);
                        d.prepend(c);
                        break;
                    }
                }
                var g = d;
                g.addClass("drop");
                TransitionController.transitionEnd(g, function() {
                    g.remove();
                });
                f = b;
                d = $("#cls .work-content").clone();
                $("h1", d).html(b.title);
                if (b.specs != "") {
                    $(".work-specs", d).html(b.specs);
                }
                if (b.info != "") {
                    $(".work-info", d).html(b.info);
                } else {
                    $(".work-info", d).remove();
                }
                $("#work_" + b.id).addClass("selected");
                var h = false;
                switch (b.type) {
                  case "video":
                    d.prepend(e);
                    h = function() {};
                    break;

                  case "website":
                    var i = b.url.replace("http://", "");
                    if (i.charAt(i.length - 1) == "/") {
                        i = i.slice(0, -1);
                    }
                    $(".work-link", d).attr("href", b.url).html(i);
                    $webContainer = $("#cls .web-container").clone();
                    $webContainer.attr("href", b.url);
                    $(".big-image", $webContainer).attr("src", b.image);
                    d.prepend($webContainer);
                    break;
                }
                a.append(d);
                setTimeout(function() {
                    d.removeClass("hold-high");
                    if (h) {
                        TransitionController.transitionEnd(d, h);
                    }
                }, 10);
            } else {
                j();
            }
        });
    }
    return {
        init: g,
        getWork: l,
        showNoWork: k
    };
}();

var Main = function() {
    var a = "";
    function b(b) {
        $.ajaxSetup({
            crossDomain: false,
            beforeSend: function(a, b) {
                if (!csrfSafeMethod(b.type)) {
                    a.setRequestHeader("X-CSRFToken", Cookie.get("csrftoken"));
                }
            }
        });
        if (!Modernizr.csstransitions) {
            TransitionController.setAutoWait(350);
        }
        Work.init();
        $(".nav-link.work").on("click", function() {
            if (a == "who") {
                window.location = "/#";
            }
            $("html, body").animate({
                scrollTop: $("#thumbsWrapper").offset().top
            }, 350);
        });
        SWFAddress.onChange = c;
        if (b.needUrlCheck) {
            $.get("/check-urls/");
        }
    }
    function c() {
        var b = SWFAddress.getPathNames();
        a = b;
        if (b.length > 0) {
            $("html, body").animate({
                scrollTop: 0
            }, 350);
            switch (b[0]) {
              case "who":
                $("body").addClass("page-who");
                break;

              default:
                $("body").removeClass("page-who");
                Work.getWork(b[0]);
                break;
            }
        } else {
            $("body").removeClass("page-who");
            Work.showNoWork();
        }
    }
    return {
        init: b
    };
}();

var TransitionController = function() {
    var a = {
        WebkitTransition: "webkitTransitionEnd",
        MozTransition: "transitionend",
        transition: "transitionend"
    }, b = a[Modernizr.prefixed("transition")], c = -1;
    function d(a, d, e) {
        if (typeof e === "undefined") {
            e = c;
        }
        if (e < 0) {
            a.unbind(b);
            a.bind(b, function() {
                a.unbind(b);
                d(a);
            });
        } else {
            setTimeout(function() {
                d(a);
            }, e);
        }
    }
    function e(a) {
        c = a;
    }
    return {
        transitionEnd: d,
        setAutoWait: e
    };
}();

var Video = function() {
    var a;
    var b;
    var c;
    var d;
    var e = false;
    var f;
    var g;
    var h = "/";
    function i(a) {
        if (typeof a.nativeControls === "undefined") a.nativeControls = false;
        if (typeof a.trueFullscreen === "undefined") a.trueFullscreen = true;
        if (typeof a.fullscreenHandler === "undefined") a.fullscreenHandler = function() {};
        if (typeof a.normalscreenHandler === "undefined") a.normalscreenHandler = function() {};
        if (typeof a.videoPath === "undefined") a.videoPath = "";
        d = new SimpleVideo("simpleVideo", {
            nativeControls: a.nativeControls,
            allowFullscreen: !$("html").is(".ie7, .ie8"),
            trueFullscreen: a.trueFullscreen,
            onFullscreen: a.fullscreenHandler,
            onNormalscreen: a.normalscreenHandler
        });
        h = a.videoPath + "/";
    }
    function j(a) {
        if (!e) {
            d.init(function() {
                e = true;
            });
            clearTimeout(f);
            setTimeout(function() {
                j(a);
            }, 100);
            return;
        }
        d.setFile([ {
            src: h + a.videoFile,
            type: "video/mp4"
        } ], a.type === "audio");
        if (typeof a.allowScrub === "undefined") a.allowScrub = true;
        d.setScrub(a.allowScrub);
        if (typeof a.hasAudio === "undefined") a.hasAudio = true;
        d.setHasAudio(a.hasAudio);
        d.setRepeat(a.loop);
        d.play();
    }
    function k() {
        if (!e) return;
        d.pause();
    }
    function l() {
        if (!e) return;
        d.play();
    }
    function m() {
        if (!e) return;
        d.seek(0);
    }
    function n() {
        if (!e) return;
        d.clear();
    }
    return {
        init: i,
        playVideo: j,
        clearVideo: n,
        pauseVideo: k,
        resumeVideo: l
    };
}();